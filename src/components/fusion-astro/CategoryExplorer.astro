---
import { CATEGORIES } from '@/lib/categories';
import { getCollection } from 'astro:content';

const allQuestions = await getCollection('questions');

// Count questions per category
const categoryCounts = CATEGORIES.reduce((acc, cat) => {
  acc[cat.id] = allQuestions.filter(q => q.data.category === cat.id).length;
  return acc;
}, {} as Record<string, number>);
---

<div class="p-8 sm:p-12 max-w-6xl mx-auto w-full mesh-bg min-h-screen">
  <header class="mb-12">
    <h2 class="text-3xl font-black text-white mb-2 uppercase tracking-tighter">Engineering Library</h2>
    <p class="text-slate-500 font-medium">Select a specialized domain to explore curated technical insights.</p>
  </header>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {CATEGORIES.map((cat, index) => (
      <a 
        href={`/questions/${cat.id}`}
        class="group glass-card p-6 rounded-2xl flex flex-col gap-4 glow-hover transition-all duration-500 hover:-translate-y-1 relative overflow-hidden animate-slide-up-reveal opacity-0"
        style={`animation-delay: ${index * 50}ms`}
      >
        <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity translate-x-4 -translate-y-4">
            <span class="material-symbols-outlined text-8xl" style={`color: ${cat.color}`}>
                {cat.icon}
            </span>
        </div>

        <div class="flex items-center justify-between relative z-10">
          <div class={`w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-blue-400 group-hover:bg-blue-500/20 group-hover:border-blue-500/30 transition-colors`}>
            <span class="material-symbols-outlined text-[24px]">
              {cat.icon}
            </span>
          </div>
          <span class="text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-blue-400 transition-colors">
            {categoryCounts[cat.id] || 0} Topics
          </span>
        </div>

        <div class="relative z-10">
          <h3 class="text-xl font-bold text-white mb-1 group-hover:text-blue-400 transition-colors uppercase tracking-tight">{cat.name}</h3>
          <p class="text-xs text-slate-500 line-clamp-2 leading-relaxed">
            {cat.description}
          </p>
        </div>
      </a>
    ))}
  </div>
</div>

<script>
  // Spotlight effect for cards
  const cards = document.querySelectorAll('.glass-card');
  cards.forEach(card => {
    card.addEventListener('mousemove', (e: Event) => {
      const mouseEvent = e as MouseEvent;
      const rect = (card as HTMLElement).getBoundingClientRect();
      const x = mouseEvent.clientX - rect.left;
      const y = mouseEvent.clientY - rect.top;
      (card as HTMLElement).style.setProperty('--mouse-x', `${x}px`);
      (card as HTMLElement).style.setProperty('--mouse-y', `${y}px`);
    });
  });
</script>
